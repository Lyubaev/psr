# PSR-2 — Руководство стандарта кодирования

Это руководство наследует и расширяет основной стандарт кодирования [PSR-1][].

Ключевые слова "ДОЛЖЕН", "НЕ ДОЛЖЕН", "НЕОБХОДИМ", "СЛЕДУЕТ", "НЕ СЛЕДУЕТ", "НУЖНО", "НЕ НУЖНО", "РЕКОМЕНДУЕТСЯ", "МОЖЕТ" и "НЕОБЯЗАТЕЛЬНО" в этом документе нужно интерпретировать как описано в [RFC 2119][].

## 1. Общие представление

- Код ДОЛЖЕН следовать стандарту [PSR-1][].

- Код ДОЛЖЕН использовать для отступа 4 пробела, вместо табуляции.

- НЕ ДОЛЖНО быть жесткого ограничения на длину строки; мягкое ограничение ДОЛЖНО иметь 120 символов; РЕКОМЕНДУЕМАЯ длина строки 80 символов или меньше.

- После объявления `namespace` и после блока импорта `use`, ДОЛЖНА быть одна пустая строка.

- Открытая фигурная скобка класса ДОЛЖНА быть на следующей строке, и закрытая фигурная скобка ДОЛЖНА быть на следующей строке после тела класса.

- Открытая фигурная скобка метода ДОЛЖНА быть на следующей строке, и закрытая фигурная скобка ДОЛЖНА быть на следующей строке после тела метода.

- Видимость ДОЛЖНА быть объявлена для каждого свойства и метода; `abstract` и `final` ДОЛЖНЫ быть указаны перед объявлением видимости; слово `static` ДОЛЖНО быть указано после объявления видимости.

- После ключевого слова управляющей структуры ДОЛЖЕН быть один пробел; при вызове метода или функции, после имени, пробела быть НЕ ДОЛЖНО.

- Открытая фигурная скобка управляющей структуры ДОЛЖНА быть на той же линии, а закрытая фигурная скобка должна быть на следующей линии после тела.

- Внутри круглых скобок управляющей структуры НЕ ДОЛЖНО быть пробелов после ее открытия, а также перед ее закрытием.

### 1.1. Пример

Это пример описывает некоторые правила:

```php
<?php
namespace Vendor\Package;

use FooInterface;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class Foo extends Bar implements FooInterface
{
    public function sampleFunction($a, $b = null)
    {
        if ($a === $b) {
            bar();
        } elseif ($a > $b) {
            $foo->bar($arg1);
        } else {
            BazClass::bar($arg2, $arg3);
        }
    }

    final public static function bar()
    {
        // тело метода
    }
}
```

## 2. Основное

### 2.1 Основной стандарт кодирования

Код ДОЛЖЕН соблюдать все правила описанные в [PSR-1][].

### 2.2 Файлы

Все PHP файлы ДОЛЖНЫ использовать UNIX LF ([перевод строк][UNIX LF]) в конце линии.

Все PHP файлы ДОЛЖНЫ заканчиваться одной пустой строкой.

Закрывающий тэг `?>` ДОЛЖЕН быть исключен из файлов, содержащих только PHP код.

### 2.3. Линии

Строки НЕ ДОЛЖНЫ иметь жесткого ограничения по длине.

Мягкое ограничение на длину строки ДОЛЖНО быть 120 символов; автоматизированная проверка стандарта кодирования ДОЛЖНА предупреждать, но НЕ ДОЛЖНА показывать ошибку мягкого ограничения.

Линиям НЕ СЛЕДУЕТ быть длиннее 80 символов; более длинные строки СЛЕДУЕТ разбить на несколько строк не более 80 символов в каждой.

Также НЕ ДОЛЖНО быть конечных пробелов в конце не пустых строк.

Пустые линии МОГУТ быть добавлены, чтобы улучшить читаемость, и выделить связанные блоки.

There MUST NOT be more than one statement per line.

### 2.4. Отступы

Код ДОЛЖЕН использовать в качестве одного отступа 4 пробела, и НЕ ДОЛЖЕН использовать табуляцию для отступов.

### 2.5. Ключевые слова и True/False/Null

[Ключевые слова](http://php.net/manual/en/reserved.keywords.php) ДОЛЖНЫ быть в нижнем регистре.

Константы `true`, `false`, и `null` ДОЛЖНЫ быть в нижнем регистре.


## 3. Объявление пространства имен и импорта

Если присутствует, ДОЛЖНА быть одна пустая строка после объявления `namespace`.

Если присутствует, все объявления импорта `use` ДОЛЖНЫ быть указаны после объявления`namespace`.

ДОЛЖНО быть одно ключевое слова `use` для каждого импорта.

ДОЛЖНА быть одна пустая строка после блока импорта `use`.

Для примера:

```php
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

// ... дополнительный PHP код ...

```


## 3. Классы, свойства и методы

Термин класс включает всё: классы, интерфейсы и traits (примеси).

### 4.1. Наследование и расширение

Ключевые слова `extends` и `implements` ДОЛЖНЫ быть указаны на той же линии, что и имя класса.

Открытая фигурная скобка класса ДОЛЖНА быть на следующей строке; закрытая фигурная скобка класса ДОЛЖНА быть на следующей строке после тела класса.

```php
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements \ArrayAccess, \Countable
{
    // константы, свойства, методы
}
```

Список интерфейсов `implements` МОЖЕТ быть разбит на несколько строк, где каждая строка имеет один отступ. При этом первый интерфейс ДОЛЖЕН быть на следующей строке, и в каждой строке ДОЛЖЕН быть только один.

```php
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements
    \ArrayAccess,
    \Countable,
    \Serializable
{
    // константы, свойства, методы
}
```

### 4.2. Свойства

Видимость ДОЛЖНА быть объявлена для каждого свойства.

Ключевое слово  `var` ЗАПРЕЩЕНО к использованию для объявления свойств.

Для каждого объявления ДОЛЖНО быть указано не более одного свойства.

НЕ СЛЕДУЕТ указывать префикс, в качестве нижнего подчеркивания, для имен свойств, объявленных как закрытые или защищенные.

Объявление свойств выглядит следующим образом

```php
<?php
namespace Vendor\Package;

class ClassName
{
    public $foo = null;
}
```

### 4.3. Методы

Видимость ДОЛЖНА быть объявлена для каждого метода.

НЕ СЛЕДУЕТ указывать префикс, в качестве нижнего подчеркивания, для имен методов, объявленных как закрытые или защищенные.

После объявления имени метода НЕ ДОЛЖНО быть символа пробела. Открытая фигурная скобка ДОЛЖНА быть на следующей строке, и закрытая фигурная скобка ДОЛЖНА быть на следующей строке после тела метода. Внутри круглых скобок, после ее открытия, а также перед ее закрытием, НЕ ДОЛЖНО быть пробела.

Объявление метода выглядит следующим образом. Обратите внимание на размещение скобок, запятых и пробелов внутри скобок:

```php
<?php
namespace Vendor\Package;

class ClassName
{
    public function fooBarBaz($arg1, &$arg2, $arg3 = [])
    {
        // тело метода
    }
}
```

### 4.4. Аргументы метода

В списке аргументов НЕ ДОЛЖНО быть пробелов перед каждой запятой, и ДОЛЖЕН быть один пробел после каждой запятой.

Аргументы метода имеющие значения по умолчанию, должны быть указаны в конце списка аргументов.

```php
<?php
namespace Vendor\Package;

class ClassName
{
    public function foo($arg1, &$arg2, $arg3 = [])
    {
        // тело метода
    }
}
```

Список аргументов МОЖЕТ быть разбит на несколько строк, где каждая строка имеет один отступ. При этом первый аргумент ДОЛЖЕН быть на следующей строке, и в каждой строке ДОЛЖЕН быть только один.

Когда список аргументов разбит на несколько строк, закрывающая круглая и открывающая фигурная скобки, должны быть указана на одной строке и разделены одним пробелом.

```php
<?php
namespace Vendor\Package;

class ClassName
{
    public function aVeryLongMethodName(
        ClassTypeHint $arg1,
        &$arg2,
        array $arg3 = []
    ) {
        // тело метода
    }
}
```

### 4.5. `abstract`, `final`, и `static`

Если присутствует,  `abstract` и `final` ДОЛЖНЫ быть указаны перед объявлением области видимости.

Если присутствует, `static` ДОЛЖЕН быть указан после объявления области видимости.

```php
<?php
namespace Vendor\Package;

abstract class ClassName
{
    protected static $foo;

    abstract protected function zim();

    final public static function bar()
    {
        // тело метода
    }
}
```

### 4.6. Вызов методов и функций

При создании вызова метода или функции, после имени НЕ ДОЛЖНО быть пробела. Внутри круглых скобок НЕ ДОЛЖНО быть пробела после открывающей и НЕ ДОЛЖНО быть пробела перед закрывающей скобками. В списке аргументов НЕ ДОЛЖНО быть пробелов перед каждой запятой, и ДОЛЖЕН быть один пробел после каждой запятой.

```php
<?php
bar();
$foo->bar($arg1);
Foo::bar($arg2, $arg3);
```

Список аргументов МОЖЕТ быть разбит на несколько строк, где каждая строка имеет один отступ. При этом первый аргумент ДОЛЖЕН быть на следующей строке, и в каждой строке ДОЛЖЕН быть только один.

```php
<?php
$foo->bar(
    $longArgument,
    $longerArgument,
    $muchLongerArgument
);
```

5. Управляющие конструкции
---------------------

Основными правилами стиля для управляющих конструкций являются следующие:

- ДОЛЖЕН быть один пробел после ключевого слова управляющей структуры;
- НЕ ДОЛЖНО быть пробелов после открытой круглой скобки;
- НЕ ДОЛЖНО быть пробелов перед закрывающей круглой скобкой;
- ДОЛЖЕН быть один пробел между закрывающей круглой и открывающей фигурной скобками;
- Тело управляющей структуры ДОЛЖНО иметь один отступ;
- Закрытая фигурная скобка ДОЛЖНА быть на следующей строке после тела.

Каждая управляющая конструкция ДОЛЖНА быть заключена в фигурные скобки. Это стандартизирует внешний вид и снижает вероятность ошибок при добавлении новых срок к телу.


### 5.1. `if`, `elseif`, `else`

Управляющая структура `if` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок, и что `else` и `elseif` находятся на той же линии, что и закрывающая скобка от предыдущего блока.

```php
<?php
if ($expr1) {
    // if блок
} elseif ($expr2) {
    // elseif блок
} else {
    // else блок;
}
```

Ключевое слово  `elseif` СЛЕДУЕТ использовать вместо `else if` чтобы все ключевые слова управляющих конструкций имели отдельные слова.


### 5.2. `switch`, `case`

Управляющая структура `switch` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок. `case` блоки ДОЛЖНЫ быть смещены на один отступ от `switch`, и ключевое слово `break` ДОЛЖНО быть смещено на такой же уровень, как и `case` блок. Должен быть указан комментарий, когда указан намеренный провал сквозь `case`.

```php
<?php
switch ($expr) {
    case 0:
        echo 'First case, with a break';
        break;
    case 1:
        echo 'Second case, which falls through';
        // провал
    case 2:
    case 3:
    case 4:
        echo 'Third case, return instead of break';
        return;
    default:
        echo 'Default case';
        break;
}
```


### 5.3. `while`, `do while`

Управляющая структура `while` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок.

```php
<?php
while ($expr) {
    // тело цикла;
}
```
Точно также, управляющая структура `do while` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок.

```php
<?php
do {
    // тело цикла;
} while ($expr);
```

### 5.4. `for`

Управляющая структура `for` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок.

```php
<?php
for ($i = 0; $i < 10; $i++) {
    // тело цикла for;
}
```

### 5.5. `foreach`

Управляющая структура `foreach` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок.

```php
<?php
foreach ($iterable as $key => $value) {
    // тело цикла foreach;
}
```

### 5.6. `try`, `catch`

Боки `try catch` выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок.

```php
<?php
try {
    // тело блока try
} catch (FirstExceptionType $e) {
    // тело блока catch
} catch (OtherExceptionType $e) {
    // тело блока catch
}
```

6. Замыкания
-----------

Замыкания ДОЛЖНЫ иметь пробел перед ключевым словом `function`, и иметь пробел до и после ключевого слова `use`.

Открытая фигурная скобка ДОЛЖНА быть на той же строке, закрытая фигурная скобка ДОЛЖНА быть на следующей строке после тела замыкания.

Внутри круглых скобок, содержащих список аргументов или содержащих список переменных, после ее открытия, а также перед ее закрытием, НЕ ДОЛЖНО быть пробела.

Внутри скобок списка аргументов и списка переменных НЕ ДОЛЖНО быть пробела перед каждой запятой, и должен быть один пробел после каждой запятой.

Аргументы, имеющие значение по умолчанию, должны быть указаны в конце списка аргументов.

Объявление замыкания выглядит следующим образом. Обратите внимание на размещение скобок, пробелов внутри скобок и запятых:

```php
<?php
$closureWithArgs = function ($arg1, $arg2) {
    // тело функции
};

$closureWithArgsAndVars = function ($arg1, $arg2) use ($var1, $var2) {
    // тело функции
};
```

Список аргументов и переменных МОЖЕТ быть разбит на несколько строк, где каждая строка имеет один отступ. При этом первый аргумент или переменная ДОЛЖЕН быть на следующей строке, и в каждой строке ДОЛЖЕН быть только один.

Когда список аргументов (аргументы или переменные) разбиты на несколько строк, закрывающая круглая и открывающая фигурная скобки, должны быть указана на одной строке и разделены одним пробелом.

Ниже приведены примеры объявления замыканий:

```php
<?php
$longArgs_noVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) {
   // тело
};

$noArgs_longVars = function () use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
   // тело
};

$longArgs_longVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
   // тело
};

$longArgs_shortVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) use ($var1) {
   // тело
};

$shortArgs_longVars = function ($arg) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
   // тело
};
```

Обратите внимание на правило форматирования, когда замыкание передается непосредственно вызывающему методу как аргумент.

```php
<?php
$foo->bar(
    $arg1,
    function ($arg2) use ($var1) {
        // тело
    },
    $arg3
);
```
[RFC 2119]: http://www.ietf.org/rfc/rfc2119.txt
[PSR-0]: https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md
[PSR-1]: https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md
[UNIX LF]: https://en.wikipedia.org/wiki/Newline